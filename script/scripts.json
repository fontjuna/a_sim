{
    "일반매수": {
        "script": "# 스크립트명 : 일반매수 v20250917.002800\n\nreason = 일반매도(logoff=True)\nif reason:\n    echo(f'[False] ({code} {name}) / {reason}')\n    ret(False)\n\nret(True)",
        "desc": "[일반매수]\n1. 일반매도 스크립트 조건에 해당하지 않고,"
    },
    "일반매도": {
        "script": "# 스크립트명 : 일반매도 v20250917.002800\n\n\"\"\"\n<키움 검색식에 구현해야 할 조건들>\n- 없음.\n\n<이 스크립트에서 적용한 조건들>\n- 작성 중\n\"\"\"\n\ndm = ChartManager(code, 'dy')\nm3 = ChartManager(code, 'mi', 3)\nlogoff = is_args('logoff', False)\n\n최고종가, 당일봉수 = m3.get_close_tops(k=1, w=128, m=128, n=1)\n\nif len(최고종가) == 0: pos = 1\nelse: pos = 최고종가[0]\n\no, h, l, c, v, ma = m3.o, m3.h, m3.l, m3.c, m3.v, m3.ma\n# 봉 특성 별칭 (필요 시 즉시 호출)\ntop, bottom = m3.body_top, m3.body_bottom\nup_tail, down_tail = m3.up_tail, m3.down_tail\nbody = m3.body\nbody_pct = m3.body_pct\nlength_pct = m3.length_pct\nup_tail_pct = m3.up_tail_pct\ndown_tail_pct = m3.down_tail_pct\nred = m3.red\nblue = m3.blue\n\nmsg = ''\nm3._ensure_data_cache()\nwith m3.suspend_ensure():\n    # 최상위: 매우 가벼운 판정들\n    if hoga(dm.c(1), 99) <= dm.c(0):\n        msg = f'상한가'\n    elif percent(c(0), h(0)) < -5.0:\n        msg = f'현재봉 고가 대비 -5% 이하 하락 중'\n    elif ma(5, 1) > ma(5, 0):\n        msg = f'현재 5이평 하락 중'\n    elif ma(10, 0) > ma(5, 0):\n        msg = f'현재 5, 10이평 역전 상태'\n    elif c(1) < ma(10, 1):\n        msg = f'전봉 종가, 10이평 역전 상태'\n    else:\n        # 현재봉으로 판단\n        if c(1) < o(0):\n            if percent(o(0), c(1)) > 1.0 and c(1) > c(0):\n                msg = f'1% 이상 갭 상승 시작 후 전봉 종가 이하로 하락'\n        elif pos == 1 and o(0) < c(1) and c(0) < o(0):\n            msg = f'현재봉 갭 하락 시작 음봉'\n\n        if not msg:\n            idx, candle = m3.get_highest_volume(m=10, n=1)\n            if candle['현재가'] > candle['시가'] >= candle['저가'] > c():\n                msg = f'10봉중 최고거래량봉 아래로 이탈'\n\n        if not msg and c() <= h(1):\n            if down_tail_pct(1) >= 1.0 and (o(1) == c(1) or down_tail(1) > body(1) * 5) and up_tail(1) < down_tail(1) * 0.2:\n                msg = f'교수형 캔들의 고가 갱신 못함'\n\n        if not msg and blue(0) and all([red(3), red(2), red(1)]) and c(3) < c(2) < c(1):\n            min_body = hoga(o(1), 5) - o(1)\n            if not (body(1) < min_body or body(3) < min_body):\n                if body(3) > body(2) > body(1) and c(1) - (c(1) - o(1)) / 2 > c():\n                    msg = f'상승 체력 소진으로 3연속 몸통이 작아 지면서 전봉 중간 이하로 하락'\n\n                elif body(1) > body(2) > body(3) and c(1) - (c(1) - o(1)) / 3 > c():\n                    msg = f'3연속 몸통이 커졌으나 체력 소진으로 고가 돌파 못한 전봉 1/3 이하로 하락'\n\n        # 이하 전봉으로 판단\n        if not msg and (h(2) > h(1) and bottom(1) >= top(2)):\n            if up_tail(1) > down_tail(1):\n                msg = f'전봉 고가 갱신 불발후 위꼬리 내부에서 마감'\n\n        if not msg and up_tail_pct(1) >= 2.0:\n            if o(1) == c(1) or up_tail(1) > body(1) * 3:\n                msg = f'전봉 윗꼬리 2%이상 유성형 패턴으로 급락'\n\n        # 음봉 패턴군 (blue)\n        if not msg and (c(1) < o(1)):\n            if up_tail_pct(1) >= 1.0:\n                if top(2) < bottom(1):\n                    msg = f'전봉 `윗꼬리 1%이상 음봉 갭 상승 마감'\n                elif (o(1) == c(1) or up_tail(1) >= body(1) * 2.5) and up_tail(1) * 0.2 > down_tail(1):\n                    msg = f'전봉 윗꼬리 1%이상 유성형 음봉'\n                elif body(1) >= up_tail(1) * 0.8:\n                    msg = f'전봉 윗꼬리 1%이상 떨어지는 칼날'\n            elif up_tail_pct(2) >= 1.0 and up_tail(2) > down_tail(2):\n                if h(2) >= h(1) and (h(1) - c(1)) / o(1) > 0.01:\n                    msg = f'전봉 윗꼬리 1%이상 연속 고가 저항'\n            elif (c(2) >= o(2)):\n                if body_pct(2) > 1:\n                    if top(2) >= top(1) and bottom(2) < bottom(1) and length_pct(1) < 1:\n                        msg = f'전봉 하락 잉태형 패턴'\n                    elif top(2) <= top(1) and bottom(2) > bottom(1):\n                        msg = f'전봉 하락 장악형 패턴'\n            elif c(3) >= o(3) and c(3) > c(1):\n                if body_pct(3) > 2 and v(3) > v(2) * 2:\n                    if m3.is_doji(0.2, 2) and c(1) < o(1) and v(3) > v(1) * 2:\n                        msg = f'하락 전환 석별형 패턴'\n\n        # 양봉 패턴군 (red)\n        if not msg and c(2) >= o(2):\n            if up_tail_pct(2) >= 1.5:\n                up = up_tail(2)\n                if c(2) > c(1) and (o(2) == c(2) or (up >= body(2) * 3 and up * 0.2 > down_tail(2))):\n                    msg = f'전전봉 윗꼬리 1.5% 이상 몸통의 3배 유성형 양봉'\n            elif body_pct(2) > 1:\n                if top(2) >= top(1) and bottom(2) < bottom(1) and length_pct(1) < 0.5:\n                    msg = f'전봉 하락 잉태형 패턴'\n\n        # 최고종가 봉 패턴군 (pos)\n        if not msg and pos > 2:\n            if h(pos) > h(1) and bottom(1) >= top(pos):\n                msg = f'전봉 최고종가봉 고가 갱신 불발후 위꼬리 내부에서 마감'\n            elif (c(pos) >= o(pos)) and body_pct(pos) > 1:\n                if top(pos) <= top(1) and bottom(pos) > bottom(1):\n                    msg = f'전봉 최고종가 하락 장악형 패턴'\n        #elif not msg and pos >= 1:\n        #    if (c(pos) - o(pos)) / 2 > c() and h(pos) > h():\n        #        msg = f'전봉 최고종가봉 고가 갱신 불발후 퇴고 종가봉 몸통 중간 이하로 하락'\n\nif msg: \n    if logoff:\n        ret(msg)\n    else:\n        echo(f'[{True}] ({code} {name}) 현재가={dm.c()} / {msg}')\n        ret(True)\nret(False)",
        "desc": "[일반매도]\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 전봉이 유성형 캔들이거나,\n7. 현재봉이 긴 윗꼬리달고 최고종가 이하로 하락시 매도"
    },
    "실전_돌파매수": {
        "script": "# 스크립트명 : 실전_돌파매수 v20250917.002800\n\n\"\"\"\n<키움 검색식에 구현해야 할 조건들>\n1. 거래대금 상위 200종목 또는 거래량 상위 200종목 이고,\n2. 주가범위 전일 기준 1,200원 ~ 99,900원 이고,\n3. 현재가 기준 시가 총액 500억원 ~ 5조원 이고,\n4. 현재가는 상승률 20% 이내이면서 전일 대비 시가가 2% 이상이거나, 시가대비 현재가가 5%이상이고,\n5. 현재봉이 양봉이면서 시가는 10이평 위이며 종가는 5이평 위이면서 3분봉 기준 128봉 중 최고종가이고\n6. 전일 최고가 대비 종가 하락율 7.5%이내이거나 전일 최고가 대비 종가 하락율 7.5%이상이면서 현재가가 전일 최고가를 넘어서야 하고\n7. 현재봉 포함 20일 최고거래량대비 1분 0, 1, 2전봉중 하나의 거래량이 2% 이상\n\n<이 스크립트에서 구현 할 조건들>\n0. 키움 검색식과 AND로 연결\n1. 최고종가 0개 또는 당일 첫봉이면 매수 안함\n2. 당일 첫봉이 음봉이고 그 고가를 돌파 못하면 매수 안함\n3. 일반매도 스크립트 조건에 해당하면 매수 안함\n4. 최고거래량 조건 불충족하면 매수 안함\n5. 5봉중 0.6% 상승 여부 불충족하면 매수 안함\n6. 3연속 최고종가 회피 (0.5% 이하 제외)\n7. 최고종가봉 보다 2% 이상에서 상승하면 매수 안함\n8. 최고종가봉이 하락 우세이면 매수 안함\n9. 전고점 넘지 못한 최고종가 회피\n10. 전 최고종가의 고가저항에 윗 꼬리 발생하면 매수 안함\n11. 최고종가 고점을 넘지 못하면 매수 안함\n12. 당일 하락율 조건 불충족하면 매수 안함\n13. 최근 10개봉 중 몸통보다 긴 윗꼬리 봉 3개 이상이면 매수 안함\n\"\"\"\nm3 = ChartManager(code, 'mi', 3)\ndt = ChartManager(code, 'dy')\n\n# 기본 값 접근자 별칭\no, h, l, c, v, ma = m3.o, m3.h, m3.l, m3.c, m3.v, m3.ma\n\n# 최고종가 조건 찾기 ========================================================================\nm3._ensure_data_cache()\nwith m3.suspend_ensure():\n    최고종가, 당일봉수 = m3.get_close_tops( k=1, w=128, m=128, n=1 )\n    첫봉위치 = 당일봉수 - 1\n\nymd = datetime.datetime.now().strftime('%H%M%S')\nif 첫봉위치 == 0:\n    bar_time_str = m3._raw_data[첫봉]['체결시간'][8:14]\n    bar_time_dt = datetime.datetime.strptime(bar_time_str, \"%H%M%S\") + datetime.timedelta(minutes=1)\n    bar_time = bar_time_dt.strftime(\"%H%M%S\")\n    if ymd <= bar_time:\n        reason = f'당일 첫봉 1 분간 매수 하지 않음'\n\nif len(최고종가) == 0:\n    echo(f'[False] ({code} {name}) / 최고종가 0개 매수 안함 : ({당일봉수}) {최고종가}')\n    ret(False)\n\npos = 최고종가[0]\n\n# 당일 첫봉이 음봉이면 그 봉 고가 밑에서 매수 안 함 =========================================\nwith m3.suspend_ensure():\n    if o(첫봉위치) > c(첫봉위치):\n        if h(첫봉위치) > c():\n            echo(f'[False] ({code} {name}) / 당일 첫봉이 음봉이고 그 고가를 돌파 못함 : ({당일봉수}) {최고종가})')\n            ret(False)\n        elif percent(h(첫봉위치), c(첫봉위치)) >= 5.0:\n            echo(f'[False] ({code} {name}) / 당일 첫봉이 음봉이고 고가 대비 5%이상 하락 : ({당일봉수}) {최고종가})')\n            ret(False)\n        elif percent(h(첫봉위치), o(첫봉위치)) > 3.0:\n            echo(f'[False] ({code} {name}) / 당일 첫봉이 음봉이고 윗꼬리 3% 이상 발생 : ({당일봉수}) {최고종가})')\n            ret(False)\n\n# 현재봉이 5%이상 상승 중이면 매수 안 함 =========================================\nwith m3.suspend_ensure():\n    if percent(c(0), o(0)) > 5.0:\n        echo(f'[False] ({code} {name}) / 현재봉이 5%이상 상승 중이면 매수 안 함 : ({당일봉수}) {최고종가})')\n        ret(False)\n\n# 일반매도 조건 찾기 ========================================================================\nreason = 일반매도(logoff=True)\nif reason:\n    echo(f'[False] ({code} {name}) / {reason}')\n    ret(False)\n\n# 최고거래량 조건 찾기 ========================================================================\ndt._ensure_data_cache()\nwith dt.suspend_ensure():\n    cache_key = f'{code}_dt_volume'\n    max_vol = 0\n    max_idx = 1\n    if cache_key not in result_cache:\n        for i in range(1, 59):\n            vol = dt.v(i)\n            if vol > max_vol:\n                max_vol = vol\n                max_idx = i\n        \n        # 필요한 데이터만 개별 접근\n        hv_h = dt.h(max_idx)\n        hv_l = dt.l(max_idx)\n        result_cache[cache_key] = {'v': max_vol, 'h': hv_h, 'l': hv_l}\n\n    dt_v = dt.v(0)\n    hv_l = result_cache[cache_key]['l']\n    hv_h = result_cache[cache_key]['h']\n    hv_v = result_cache[cache_key]['v']\n\nif not (hv_h <= o(0) or hv_l > h(1) and max_idx > 1 or dt_v >= hv_v * 0.67):\n    echo(f'[False] ({code} {name}) / 최고거래량 조건 불충족')\n    ret(False)\n\n# 상승율 조건 찾기 ========================================================================\nwith m3.suspend_ensure():\n    more_than = 0\n    for i in range(5):\n        if c(i) >= hoga(c(i + 1), 3): \n            more_than += 1\n            break\n\nif more_than == 0: # or less_than > 0:\n    echo(f'[False] ({code} {name}) / 5봉중 3호가 이상 상승 여부 불충족')\n    ret(False)\n\n# 연속봉수 조건 찾기 ========================================================================\nwith m3.suspend_ensure():\n    연속갯수 = 0\n    for i in range(1, 128):\n        if c(i) == 0: break\n        compare_start = i + 1\n        compare_end = i + 128\n        max_close = 0\n        for j in range(compare_start, compare_end):\n            cj = c(j)\n            if cj == 0: break\n            if cj > max_close: max_close = cj\n        if c(i) > max_close:\n            상승률 = percent(c(i), c(i + 1))\n            if 상승률 > 0.5:\n                연속갯수 += 1\n                if 연속갯수 >= 3:\n                    break\n        else:\n            break\n\nif 연속갯수 >= 3:\n    echo(f'[False] ({code} {name}) / 3연속 최고종가 회피 (0.5% 이하 제외) (연속갯수: {연속갯수})')\n    ret(False)\n\n# 전 최고종가의 고가 아래이면 다음을 만족 해야 함 ========================================================================\nwith m3.suspend_ensure():\n    if c(0) < h(pos):\n        if percent(c(pos), o()) > 2.0:\n            echo(f'[False] ({code} {name}) / 최고종가봉 보다 2% 이상에서 상승 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        if h(pos) - c(pos) > c(pos) - l(pos) and h(pos) > c(0):\n            echo(f'[False] ({code} {name}) / 최고종가봉이 하락 우세임 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        up_tail_pct = m3.up_tail_pct\n        body_pct = m3.body_pct\n        \n        if up_tail_pct(pos+1) > 1.0 and h(pos+1) >= h(pos):\n            echo(f'[False] ({code} {name}) / 전고점 넘지 못한 최고종가 회피 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        # 전 최고종가를 넘었어도 윗꼬리가 계속 발생하며 고가 갱신을 못함\n        if up_tail_pct(pos) > 1.0 and h(pos) >= h(1) > c(1) and up_tail_pct(1) > body_pct(1) * 1.5:\n            echo(f'[False] ({code} {name}) / 전 최고종가의 고가저항에 윗 꼬리 발생 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        # 윗 꼬리 단 최고 종가의 고점을 넘지 못하면 매물대 라는 뜻으로 올라가기 쉽지 않다.\n        if pos > 1:\n            label, pct = m3.price_position(n=pos, price=c(0))\n            if pct['h_pct'] - pct['c_pct'] > 1.0 and h(pos) > dt.h(0):\n                # 추가적인 조건이 필요 함\n                echo(f'[False] ({code} {name}) / 최고종가 고점을 넘지 못함 : ({당일봉수}) {최고종가}')\n                ret(False)\n\n        if pos > 1:\n            extr = m3.get_extremes(m=pos, n=1)\n            하락률 = percent(extr['hh'], extr['ll'])\n            시작위치 = percent(extr['ll'], o(0))\n            if 하락률 > 5.0 and 시작위치 < 80.0 and not (l(pos) <= extr['ll'] and h(pos) >= extr['hh']):\n                echo(f'[False] ({code} {name}) / 당일 하락율 조건 불충족 : ({당일봉수}) {최고종가}')\n                ret(False)\n\n        # if not (extr['hv'] > v(pos) or v(pos) * 0.8 < v(0)):\n        #     echo(f'[False] ({code} {name}) / 전고돌파 수급 조건 불충족 : ({당일봉수}) {최고종가}')\n        #     ret(False)\n\n        # 일봉상 긴 윗꼬리가 달린 봉이 많이 나타나는 종목은 털리기 쉽다.\n        윗꼬리_많은종목 = 0\n        한계치 = 3\n        for i in range(1, 11):\n            up_tail = dt.h(i) - max(dt.o(i), dt.c(i))\n            body = abs(dt.o(i) - dt.c(i))\n            body_pct = percent(body, dt.o(i))\n            if body > 0 and body_pct > 1 and up_tail > body: 윗꼬리_많은종목 += 1\n            if 윗꼬리_많은종목 >= 한계치: break\n        if 윗꼬리_많은종목 >= 한계치:\n            echo(f'[False] ({code} {name}) / 최근 10개봉 중 몸통보다 긴 윗꼬리 봉 {윗꼬리_많은종목}개')\n            ret(False)\n\necho(f'[True] ({code} {name}) / ({당일봉수}) {최고종가}')\nret(True)",
        "desc": "[돌파매수]\n1. 일반매도 스크립트 조건에 해당하지 않고,\n2. 최고종가 갱신봉이 당일 1개 이상이어야 하고,\n3. 당일 최고종가 대비 최저 종가는 -5%이상이고,\n4. 마지막 최고종가의 봉상태가 고가와 종가 차이가 저가와 종가 차이보다 작아야 함"
    },
    "거래량매수": {
        "script": "# 스크립트명 : 거래량매수 v20250920.170345\n\nm3 = ChartManager(code, 'mi', 3)\ndt = ChartManager(code, 'dy')\n\n# 기본 값 접근자 별칭\no, h, l, c, v, ma = m3.o, m3.h, m3.l, m3.c, m3.v, m3.ma\nup_tail_pct = m3.up_tail_pct\nbody_pct = m3.body_pct\nbottom, top = m3.body_bottom, m3.body_top\n\n# 최고종가 조건 찾기 ========================================================================\nm3._ensure_data_cache()\nwith m3.suspend_ensure():\n    최고종가, 당일봉수 = m3.get_close_tops( k=1, w=128, m=128, n=1 )\n    첫봉 = 당일봉수 - 1\n\nif len(최고종가) == 0:\n    echo(f'[False] ({code} {name}) / 최고종가 0개 매수 안함 : ({당일봉수}) {최고종가}')\n    ret(False)\n\nstart_rate = percent(o(첫봉), dt.c(1)) # 당일 시가 갭 상승 여부 및 시작 %\npos = 최고종가[0]\nmsg = ''\n\nwith m3.suspend_ensure():\n    # 장 시작후 3번째 봉 이내인 경우\n    if 첫봉 == 0: # 현재 첫봉\n        ymd = datetime.datetime.now().strftime('%H%M%S')\n        bar_time_str = m3._raw_data[첫봉]['체결시간'][8:14]\n        bar_time_dt = datetime.datetime.strptime(bar_time_str, \"%H%M%S\") + datetime.timedelta(minutes=1)\n        bar_time = bar_time_dt.strftime(\"%H%M%S\")\n        if ymd <= bar_time:\n            msg = f'당일 첫봉 1 분간 매수 하지 않음'\n    else:\n        if o(첫봉) > c():\n            msg = f'3분봉 종가가 당일 시가 이하이면 매수 안함'\n\n    if msg:\n        echo(f'[False] ({code} {name}) / {msg} : ({당일봉수}) {최고종가}')\n        ret(False)\n\n# 현재봉이 5%이상 상승 중이면 매수 안 함 #####\n#with m3.suspend_ensure():\n#    if percent(c(0), o(0)) > 5.0:\n#        echo(f'[False] ({code} {name}) / 현재봉이 5%이상 상승 중이면 매수 안 함 : ({당일봉수}) {최고종가}')\n#        ret(False)\n\n# 일반매도 조건 찾기 #####\nreason = 거래량매도(logoff=True)\nif reason:\n    echo(f'[False] ({code} {name}) / {reason}')\n    ret(False)\n\n# 전 최고종가의 고가 아래이면 다음을 만족 해야 함 #####\nwith m3.suspend_ensure():\n    if c(0) < h(pos):\n        #if pos < 5 and percent(c(pos), o()) > 2.0:\n        #    echo(f'[False] ({code} {name}) / 최고종가 보다 시가가 2% 아래에서 시작 : ({당일봉수}) {최고종가}')\n        #    ret(False)\n\n        if h(pos) - c(pos) > c(pos) - l(pos) and h(pos) > c(0):\n            echo(f'[False] ({code} {name}) / 최고종가봉이 하락 우세임 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        if up_tail_pct(pos+1) > 1.0 and h(pos+1) >= h(pos):\n            echo(f'[False] ({code} {name}) / 전고점 넘지 못한 최고종가 회피 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        # 전 최고종가를 넘었어도 윗꼬리가 계속 발생하며 고가 갱신을 못함\n        if up_tail_pct(pos) > 1.0 and h(pos) >= h(1) > c(1) and up_tail_pct(1) > body_pct(1) * 1.5:\n            echo(f'[False] ({code} {name}) / 전 최고종가의 고가저항에 윗 꼬리 발생 : ({당일봉수}) {최고종가}')\n            ret(False)\n\n        if  up_tail_pct(pos) > 2.5:\n            echo(f'[False] ({code} {name}) / 전 최고종가의 윗꼬리 2.5% 이상 발생 매수 안 함: ({당일봉수}) {최고종가}')\n            ret(False)\n\n        # 윗 꼬리 단 최고 종가의 고점을 넘지 못하면 매물대 라는 뜻으로 올라가기 쉽지 않다.\n        if pos > 1:\n            label, pct = m3.price_position(n=pos, price=c(0))\n            if pct['h_pct'] - pct['c_pct'] > 1.0 and h(pos) > dt.h(0):\n                # 추가적인 조건이 필요 함\n                echo(f'[False] ({code} {name}) / 최고종가 고점을 넘지 못함 : ({당일봉수}) {최고종가}')\n                ret(False)\n\n        # 일봉상 긴 윗꼬리가 달린 봉이 많이 나타나는 종목은 털리기 쉽다.\n        윗꼬리_많은종목 = 0\n        한계치 = 3\n        for i in range(1, 11):\n            up_tail = dt.h(i) - max(dt.o(i), dt.c(i))\n            body = abs(dt.o(i) - dt.c(i))\n            body_pct = percent(body, dt.o(i))\n            if body > 0 and body_pct > 1 and up_tail > body: 윗꼬리_많은종목 += 1\n            if 윗꼬리_많은종목 >= 한계치: break\n        if 윗꼬리_많은종목 >= 한계치:\n            echo(f'[False] ({code} {name}) / 최근 10개봉 중 몸통보다 긴 윗꼬리 봉 {윗꼬리_많은종목}개')\n            ret(False)\n\necho(f'[True] ({code} {name}) / ({당일봉수}) {최고종가}')\nret(True)",
        "desc": "[일반매수]\n1. 일반매도 스크립트 조건에 해당하지 않고,"
    },
    "거래량매도": {
        "script": "# 스크립트명 : 거래량매도 v20250920.170415\n\ndm = ChartManager(code, 'dy')\nm3 = ChartManager(code, 'mi', 3)\nlogoff = is_args('logoff', False)\n\no, h, l, c, ma = m3.o, m3.h, m3.l, m3.c, m3.ma\nblue, red, body, top, bottom = m3.blue, m3.red, m3.body, m3.body_top, m3.body_bottom\nup_tail_pct = m3.up_tail_pct\nbody_pct = m3.body_pct\n\nbuy_idx = bar_idx(buy_dt)\n#echo(f'매수일시={buy_dt}, 봉인덱스={buy_idx}')\n\nmas = [10, 15, 7, 5, 3]\nmsg = ''\n\nm3._ensure_data_cache()\nwith m3.suspend_ensure():\n    \n    if hoga(dm.c(1), 99) <= dm.c(0):\n        msg = f'상한가'\n    elif up_tail_pct() > 3.0:\n        msg = f'현재봉 윗꼬리 3% 이상 발생 매도'\n    else:\n        rise, fall, below = m3.get_rising_state(mas, 0)\n        try:\n            pos = rise['hc']\n            bars = rise['bars']\n            첫봉 = rise['today_bars'] - 1\n            start_rate = percent(o(첫봉), dm.c(1)) # 당일 시가 갭 상승 여부 및 시작 % (상승 gap 이면 > 0)\n            rise_rate = rise['rise_rate']\n            three_rate = rise['three_rate']\n        except:\n            msg = f'상승 상태 분석 실패'\n\n        if not msg:\n            # 각 이평 타고 상승 했는지 여부 판단 (긴 이평부터 검사)\n            size = max(rise['max_red'][1], rise['max_blue'][1])\n            if size < 1.0:\n                if ma(20, 1) > c(1): msg = f'20이평 첫 이탈 매도'\n            elif size < 1.5:\n                if ma(15, 1) > c(1): msg = f'15이평 첫 이탈 매도'\n            elif size < 2:\n                if ma(10, 1) > c(1): msg = f'10이평 첫 이탈 매도'\n            elif size < 2.5:\n                if ma(7, 1) > c(1): msg = f'7이평 첫 이탈 매도'\n            elif size < 3:\n                if ma(5, 1) > c(1): msg = f'5이평 첫 이탈 매도'\n            elif size < 3.5:\n                if ma(3, 1) > c(1): msg = f'3이평 첫 이탈 매도'\n            else:\n                if three_rate >= 10:\n                    if c(pos) - (c(pos) - o(pos)) / 4 > c(): msg = f'급등시 음봉에서 매도'\n                elif three_rate >= 8:\n                    if ma(3, 1) > c(1): msg = f'3봉 상승 8% 이상 3이평 이탈 매도'\n                elif three_rate >= 6:\n                    if ma(5, 1) > c(1): msg = f'3봉 상승 6% 이상 5이평 이탈 매도'\n                elif three_rate >= 5:\n                    if ma(7, 1) > c(1): msg = f'3봉 상승 5% 이상 7이평 이탈 매도'\n                elif three_rate >= 4:\n                    if ma(10, 1) > c(1): msg = f'3봉 상승 4% 이상 10이평 이탈 매도'\n                elif three_rate >= 3:\n                    if ma(15, 1) > c(1): msg = f'3봉 상승 3% 이상 15이평 이탈 매도'\n\n        if not msg:\n            if rise_rate >= 15:\n                if ma(3, 1) > c(1): msg = f'상승 시작 후 15% 이상 3이평 이탈 매도'\n            elif rise_rate >= 10:\n                if ma(5, 1) > c(1): msg = f'상승 시작 후 10% 이상 5이평 이탈 매도'\n            elif rise_rate >= 7:\n                if ma(7, 1) > c(1): msg = f'상승 시작 후 7% 이상 7이평 이탈 매도'\n            elif rise_rate >= 5:\n                if ma(10, 1) > c(1): msg = f'상승 시작 후 5% 이상 10이평 이탈 매도'\n            elif rise_rate >= 4:\n                if ma(15, 1) > c(1): msg = f'상승 시작 후 4% 이상 15이평 이탈 매도'\n\n        if not msg:\n            if ma(20, 1) > c(1): msg = f'20이평 이탈 매도'\n            elif c(pos) > c() and rise['up_tails'] >= 2 and pos < 3: # up_tails:현재봉 포함 수량 임\n                msg = f'윗꼬리 2개 이상 발생 매도'\n\nif logoff: ret(msg)\nif msg: echo(f'[True] ({code} {name}) 현재가={dm.c()} / {msg}')\nret(msg!='')",
        "desc": "[일반매도]\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 전봉이 유성형 캔들이거나,\n7. 현재봉이 긴 윗꼬리달고 최고종가 이하로 하락시 매도"
    }
}
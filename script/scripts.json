{
    "실전_돌파매수": {
        "script": "# 스크립트명 : 실전_돌파매수\n\"\"\"\n<검색식에서 구현: 매수조건>\n1. 거래대금 상위 200종목 또는 거래량 상위 200종목 이고,\n2. 주가범위 전일 기준 1,200원 ~ 99,900원 이고,\n3. 현재가 기준 시가 총액 500억원 ~ 5조원 이고,\n4. 현재가는 상승률 20% 이내이면서 전일 대비 시가가 2% 이상이거나, 시가대비 현재가가 5%이상이고,\n5. 현재봉이 양봉이면서 시가는 10이평 위이며 종가는 5이평 위이면서 3분봉 기준 128봉 중 최고종가이고\n6. 전일 최고가 대비 종가 하락율 7.5%이내이거나 전일 최고가 대비 종가 하락율 7.5%이상이면서 현재가가 전일 최고가를 넘어서야 하고\n7. 현재봉 포함 120일 최고거래량대비 1분 0, 1, 2전봉중 하나의 거래량이 2% 이상\n\n<스크립트에서 구현>\n1. 일반매도 스크립트 조건에 해당하지 않고,\n2. 전봉이 유성형 캔들이 아니고,\n3. 전봉이 교수형 캔들이 아니고,\n4. 전봉이 긴 음봉이 아니고,\n5. 최고종가 갱신봉이 당일 1개 이상이어야 하고,\n6. 최고종가봉중 0.5% 이하 상승봉은 없는 봉으로 간주하여 3연속 최고종가는 회피하고,\n7. 당일 최고종가 대비 최저 종가는 -5%이상이거나 시가가 고가 보다 높아야 하고,\n8. 마지막 최고종가의 봉상태가 고가와 종가 차이가 저가와 종가 차이보다 작아야 하고 아니면 그 고가를 넘어서야 함,\n9. 59일(당일 제외) 최고거래량 봉의 최고가를 시가가 높거나 최고거래량의 시가와 현재봉 시가가 -20%이하 이거나 최고 거래량의 67% 이상이어야 함.\n\"\"\"\nm3 = ChartManager(code, 'mi', 3)\ndt = ChartManager(code, 'dy')\ndh, dc, do, dv = dt.h, dt.c, dt.o, dt.v\nmo, mh, ml, mc, mv = m3.o, m3.h, m3.l, m3.c, m3.v\n\n매도조건 = 일반매도(logoff=True)\nif 매도조건:\n    echo(f'[{False}] ({code} {name}) / 매도조건에 해당')\n    ret(False)\n\nif m3.is_shooting_star(m=1, length=1.5, up=2.5):\n    echo(f'[False] ({code} {name}) / 유성형 캔들 다음 매수 안함')\n    ret(False)\n\nif m3.is_hanging_man(m=1, length=1, down=5):\n    echo(f'[False] ({code} {name}) / 교수형 캔들 다음 매수 안함')\n    ret(False)\n\nif div(mc(1) - mo(1), mo(1), 0) < -0.02 and mh(1) > mc(0):\n    echo(f'[False] ({code} {name}) / 긴 음봉 다음 매수 안함')\n    ret(False)\n\n# 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\ngcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n최고종가 = gcts[0] #개장후n봉최고종가\n당일봉수 = gcts[1]\n최고종가_len = len(최고종가) if 최고종가 else 0\n\nif 최고종가_len == 0:\n    echo(f'[False] ({code} {name}) / 최고종가 0개')\n    ret(False)\n\nif 당일봉수 == 1: \n    echo(f'[False] ({code} {name}) / 당일 첫봉 매수 안함 : ({당일봉수}) {최고종가}')\n    ret(False)\n\n# 3연속 최고종가 회피 (0.5% 이하는 없는 봉으로 간주)\nif 최고종가_len >= 2:\n    연속갯수 = 0\n    for i in range(최고종가_len):\n        봉위치 = 최고종가[-(i+1)]  # 뒤에서부터 읽기 (현재봉부터)\n        if i > 0 and 봉위치 != 최고종가[-(i)] - 1:  # 연속되지 않으면 종료\n            break\n        상승률 = div(mc(봉위치) - mc(봉위치 + 1), mc(봉위치 + 1), 0)\n        if 상승률 > 0.005:  # 양봉이면서 0.5% 초과\n            연속갯수 += 1\n            if 연속갯수 >= 3:  # 3개 이상이면 즉시 종료\n                break\n        # 음봉이거나 0.5% 이하면 없는 봉으로 간주하고 계속 진행\n    \n    if 연속갯수 >= 3:\n        echo(f'[False] ({code} {name}) / 3연속 최고종가 회피 (0.5% 이하 제외) : ({당일봉수}) {최고종가} (연속갯수: {연속갯수})')\n        ret(False)\n\nloc = 최고종가[-1]\n\nextr = m3.get_extremes(n=loc-1, m=1)\n하락률 = div(extr['hh'] - extr['lc'], extr['hc'], 0)\nif not (하락률 > -0.05 or 하락률 < -0.05 and extr['hh'] < mo(0)):\n    echo(f'[False] ({code} {name}) / 당일 하락율 조건 불충족 : ({당일봉수}) {최고종가}')\n    ret(False)\n\nif mc(loc) - ml(loc) < mh(loc) - mc(loc) and mh(loc) > mc(0):\n    echo(f'[False] ({code} {name}) / 최고종가봉이 하락 우세임 : ({당일봉수}) {최고종가}')\n    ret(False)\n\nidx, date, o, h, l, c, v, a = dt.get_highest_volume(119, 1)\ndiff = div(l - mo(0), mo(0), 0) >= 0.20\nif not (h <= mo(0) or diff or dv(0) >= v * 0.67):\n    echo(f'[False] ({code} {name}) / 최고거래량 조건 불충족 : ({당일봉수}) {최고종가}')\n    ret(False)\n\necho(f'[True] ({code} {name}) / ({당일봉수}) {최고종가}')\nret(True)",
        "type": "bool",
        "desc": "[돌파매수]\n1. 일반매도 스크립트 조건에 해당하지 않고,\n2. 최고종가 갱신봉이 당일 1개 이상이어야 하고,\n3. 당일 최고종가 대비 최저 종가는 -5%이상이고,\n4. 마지막 최고종가의 봉상태가 고가와 종가 차이가 저가와 종가 차이보다 작아야 함"
    },
    "실전_일반매도": {
        "script": "## 스크립트명 : 실전_일반매도\n\n\"\"\"\n<검색식에서 구현: 보유종목대상>\n1. 상한가 이거나,\n2. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n3. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n4. 현재가가 10이평 이하 이거나,\n5. 3분봉에서 봉 하나에 3%이상 급락 하거나,\n6. 3분봉에서 봉 하나에 7.5%이상 급등시\n\"\"\"\n\ndm = ChartManager(code, 'dy')\nm3 = ChartManager(code, 'mi', 3)\nlogoff = is_args('logoff', False)\ndc = dm.c\nmo, mc, ml, ma = m3.o, m3.c, m3.l, m3.ma\n\nif not logoff:\n    # 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\n    gcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n    최고종가 = gcts[0] #개장후n봉최고종가\n    당일봉수 = gcts[1]\n\nmsg = ''\nif not logoff:\n    if m3.is_shooting_star(n=1, length=1.5, up=2.5, down=1) and max(mo(1), mc(1)) > mc() and 최고종가[-1] == 1:\n        msg += f'유성형'\n\nif msg: \n    if not logoff:\n        echo(f'[{True}] ({code} {name}) 현재가={dc()} / 매도조건: {msg}')\n    ret(True)\n\nret(False)",
        "type": "bool",
        "desc": "[실전_일반매도]\n\n<검색식에서 구현: 보유종목대상>\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 3분봉에서 봉 하나에 3%이상 급락 하거나,\n7. 3분봉에서 봉 하나에 7.5%이상 급등시 매도\n\n<스크립트에서 구현>\n1. 유성형 캔들"
    },
    "일반매도": {
        "script": "# 스크립트명 : 일반매도\n\n\"\"\"\n<검색식에서 구현: 보유종목대상>\n- 없음.\n\n<스크립트에서 구현>\n1. 상한가 이거나\n2. 3분봉 5이평이 하락전환 하거나\n3. 3분봉 5이평이 10이평 이하 이거나\n4. 현재가가 10이평 이하 이거나\n5. 유성형(전봉 위꼬리는 1.5%이상 몸통의 2.5배 이상이고 max(전봉시가, 종가) 보다 현재가 낮음) 이거나\n6. 교수형(전봉 아래꼬리는 1.5%이상 몸통의 5배 이상이고 전봉 고가갱신을 못함) 이거나\n7. 막다른 골목(상승중 장대양봉이 서고 그 종가보다 낮은 시가로 양봉마감 했지만 고가 돌파 못함) 이거나\n8. 상승장 갭 상승 음봉(현재봉 시가가 이전봉 종가보다 낮고 종가가 이전봉 시가보다 낮음) 이거나\n\"\"\"\ndm = ChartManager(code, 'dy')\nm3 = ChartManager(code, 'mi', 3)\nlogoff = is_args('logoff', False)\ndc = dm.c\nmo, mc, ml, mh, ma = m3.o, m3.c, m3.l, m3.h, m3.ma\n\n#f not logoff:\n# 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\ntops = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n최고종가 = tops[0]\n당일봉수 = tops[1]\nif len(최고종가) < 1: pos = 1\nelse: pos = 최고종가[-1]\n\nmsg = ''\nc_limit = hoga(dc(1), 99)\nif c_limit <= dc(0):\n    msg += f'상한가'\nelif div(mh(1) - mo(1), mo(1), 0) >= 0.02 and mo(1) > mc(1): #2% 이상 상승해서 시가 밑으로 하락(음봉)\n    msg += f'윗꼬리 긴 음봉으로 급락'\nelif ma(5, 2) <= ma(5, 1) and ma(5, 1) > ma(5, 0) and ma(5) > mc():\n    msg += f'3분 5이평 하락 전환'\nelif ma(10) > ma(5):\n    msg += f'3분 5, 10이평 역전'\nelif ma(10) > mc():\n    msg += f'현재가 10이평 아래'\nelif mc(pos) > mo(1) > mc(1) > mo(pos): # 최고종가 보다 낮게 시작한 음봉이 최고종가 시가를 깨진 않았으나,\n    # 최고종가봉은 1.5%이상이며 전봉이 고가 갱신을 못함\n    if div(mc(pos) - mo(pos), mo(pos), 0) >= 0.015 and mh(pos) > mh(1):\n        msg += f'하락 잉태형'\nelif div(mh(pos) - mc(pos), mc(pos), 0) >= 0.01 and mh(pos) > mh(1) > mo(1) > mc(pos) > mc(1):\n    # 긴 윗꼬리의 최고종가봉의 고가를 갱신 못한 음봉 발생\n    msg += f'긴 윗꼬리 최고종가봉 돌파 못하고 음봉 하락'\nelif m3.is_shooting_star(m=pos, length=1.5, up=2.5) and mc(pos) <= mc(1):\n    msg += f'유성형 캔들'\nif m3.is_hanging_man(m=2, length=1, down=5) and mh(pos) > mh(1):\n    msg += f'교수형 캔들'\nelif mc(pos)<= mo(1) and mo(pos) >= mc(1):  # 하락 포괄 패턴\n    if div(mc(pos) - mo(pos), mo(pos), 0) >= 0.015:\n        msg += f'하락 포괄 패턴'\nelif mo(3) > mc(2) and mh(3) > mh(2):\n    꼬리 = div(mh(3) - mc(3), mc(3), 0)\n    몸통 = div(abs(mc(3) - mo(3)), mo(3), 0)\n    if 꼬리 >= 0.06 and 몸통 >= 0.01:\n        msg += f'막다른 골목 패턴'\nelif mo(2) < mc(2) < mc(1) < mo(1):\n    msg += f'상승장 갭 상승 음봉'\n\nif msg: \n    if not logoff:\n        echo(f'[{True}] ({code} {name}) 현재가={dc()} / 매도조건: {msg}')\n    ret(True)\n\nret(False)",
        "type": "bool",
        "desc": "[일반매도]\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 전봉이 유성형 캔들이거나,\n7. 현재봉이 긴 윗꼬리달고 최고종가 이하로 하락시 매도"
    },
    "이동평균_사용예": {
        "script": "ct = ChartManager(code, 'mi', 3)\n\n# 기본사용\nma5 = ct.indicator(ct.avg, ct.c, 5)\necho(f'기본사용: 0={ma5(0)},1={ma5(1)},2={ma5(2)}')\n\n# 주입하여 사용\nma = ct.ma # ma에 주입\necho(f'주입사용: 0={ma(5,0)},1={ma(5,1)},2={ma(5,2)}')\n\n# 리스트로 받아와 사용\nm5 = ct.get_ma(5, 10) # 5이평 10개 받음\necho(f'리스트로: 0={m5[0]},1={m5[1]}, 2={m5[2]}')\n\n# 클래스를 정의하여 이용\nma5 = FMA(code, 'mi', 1, 5)\necho(f'클래스로: 0={m5[0]},1={m5[1]}, 2={m5[2]}')\n\n# 결론\n# 주입사용이 최고 좋다 - 빠르고 메모리 효율 좋고 유연성(동적 기간), 간결\n# 다음이 indicator - 캐싱효과 \n\nresult = True\nret(result)",
        "type": "bool",
        "desc": ""
    },
    "조건평가데이타": {
        "script": "ct = ChartManager(code, 'dy', 3)\n\n# 최근 종가가 60000 미만인 봉 이후로 몇 봉이 지났는지 알고 싶을 때\nbars = ct.bars_since(lambda i: ct.c(i) < 60000)\necho(f'지난봉수: {bars}')\n\n# 최근 2번째로 종가가 60000 미만 이후부터 현재까지 고가의 최고값\nhigh = ct.highest_since(2, lambda i: ct.c(i) < 60000, ct.h)\necho(f'최고가: {high}')\n\n#최근 3번째로 종가가 60000을 넘은 시점의 시가:\nopen_price = ct.value_when(3, lambda i: ct.c(i) > 60000, ct.o)\necho(f'세번째: {open_price}')\n\n#시간이 '090000'이후로 지나간 봉수:\nmt = ChartManager(code, 'mi', 3)\npast_bars = mt.bars_since(lambda x: mt.bar_time(x) <= '090000')\necho(f'시작시간: 현재봉:{mt.bar_time()} 지난봉:{past_bars}')\n\nresult = True\nret(result)",
        "type": "bool",
        "desc": ""
    }
}
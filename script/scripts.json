{
    "실전_일반매도": {
        "script": "# 스크립트명 : 실전_일반매도\n\nlogoff = is_args('logoff', False)\ndm = ChartManager(code, 'dy')\ndc = dm.c\nm3 = ChartManager(code, 'mi', 3)\nmo, mc, ml, ma = m3.o, m3.c, m3.l, m3.ma\n\n기준가 = 0\nif not logoff:\n    # 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\n    gcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n    최고종가 = gcts[0] #개장후n봉최고종가\n    당일봉수 = gcts[1]\n    기준가 = min(mc(최고종가[-2]), ml(최고종가[-1])) if len(최고종가) > 1 else 0\n\n윗그림자조건 = False\n\nmsg = ''\nif not 윗그림자조건: msg = '윗그림자조건'\n\nif not msg: msg = \" 없음\"\n\n# 전략평가 전송\nresult = 윗그림자조건\nif not logoff: echo(f'[{result}] ({code} {name}) 현재가={dc()} / 매도조건: {msg}')\nret(result)",
        "type": "bool",
        "desc": "[실전_일반매도]\n\n<검색식에서 구현: 보유종목대상>\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 3분봉에서 봉 하나에 3%이상 급락 하거나,\n7. 3분봉에서 봉 하나에 7.5%이상 급등시 매도\n\n<스크립트에서 구현>"
    },
    "실전_돌파매수": {
        "script": "# 스크립트명 : 실전_돌파매수\n#ret(True)\n# 다른코드로 테스트\n#code='018250'\n#echo(f'coide={code}')\n\n# 차트\nm3 = ChartManager(code, 'mi', 3)\ndt = ChartManager(code, 'dy')\n\n# 함수주입\ndh, dc, do, dv = dt.h, dt.c, dt.o, dt.v\nmo, mh, ml, mc, mv = m3.o, m3.h, m3.l, m3.c, m3.v\n\n# 빠른 리턴\n매도조건 = 일반매도(logoff=True)\nif 매도조건:\n    echo(f'[{False}] ({code} {name}) 취소원인=매도조건에 해당')\n    ret(False)\n\n# 전일 종가는 최고가 기준 -5% 이상이 아니면 전일 고가를 넘어야 함\n전일종가율 = div(dc(1) - dh(1), dh(1), 0)\nif dh(1) > mc() and 전일종가율 < -0.05:\n    echo(f'[{False}] ({code} {name}) 취소원인=전일종가율({전일종가율*100:.2f}) 불충족')\n    ret(False)\n\n# 1봉전 128봉중 최고거래량 cnt개의 평균    \n탑텐평균 = m3.top_volume_avg(n=128, m=1, cnt=10) * 0.8\n탑텐평균조건 = mv() >= 탑텐평균\n\n# 최근 n 개봉이 전일 3분봉 평균 거래량의 5배 이상\n최근최고봉 = max(mv(), mv(1), mv(2), mv(3), mv(4), mv(5))\n전일삼분평균 = dv(1) / 128\n삼분평균조건 = 최근최고봉 > 전일삼분평균 * 5\n\n# 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\ngcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n최고종가 = gcts[0] #개장후n봉최고종가\n당일봉수 = gcts[1]\n최고종가_len = len(최고종가) if 최고종가 else 0\n\nif 최고종가_len <= 1 or 최고종가[-1] > 당일봉수: \n    echo(f'[False] ({code} {name}) 취소원인={최고종가} 당일최고종가 1개 이하')\n    ret(False)\necho(f'당일봉수={당일봉수} {최고종가}')\n\nobvs = m3.get_obv_array(최고종가[-1] + 1)\nOBV조건 = obvs[최고종가[-1]] < obvs[0] if 최고종가[-1] >= 2 else True\n\n# 거래량 판단\nif not (탑텐평균조건 or 삼분평균조건 or OBV조건):\n    msg = ''\n    if not 탑텐평균조건: msg += '탑텐평균조건, '\n    if not 삼분평균조건: msg += '삼분평균조건, '\n    if not OBV조건: msg += 'OBV조건, '\n    echo(f'[{False}] ({code} {name}) 취소원인={msg}조건 불충족')\n    ret(False)\n\n# 마지막 최고종가의 위치까지 각 최고, 최저값 획득\nextr = m3.get_extremes(n=최고종가[-1], m=1)\n\n# 종가 기준 고가보다 저가가 더 큰것만 매수(첫봉 음봉등 배제-아래꼬리가 더 길면 매수)\nloc = 최고종가[-1]\n고저대비 = mc(loc) - ml(loc) > mh(loc) - mc(loc)\n#고저대비 = mc() - extr['ll'] > extr['hh'] - mc()\n\n# 시간조정조건 : 최고종가에서 종가상 5%이상 빠지면 매수 안 함\n하락율 = div(extr['hc'] - extr['lc'], extr['hc'], 0)\n시간조정조건 = 하락율 > -0.05\n현재봉조건 = mc() >= mc(최고종가[-1])\n\n# 로깅\nmsg = ''\nif not 고저대비: msg += f'고저대비, '\nif not 시간조정조건: msg += f'시간조정조건({하락율}>-0.05, '\nif not 현재봉조건: msg += f'현재봉조건({mc():,d}>={mc(최고종가[-1]):,d})'\n\n# 전략평가 결과 전달\nresult = 고저대비 and 시간조정조건 and 현재봉조건\nif msg: msg = '취소원인 = ' + msg +' 불충족'\necho(f'[{result}] ({code} {name}) {msg}')\n\nret(result)",
        "type": "bool",
        "desc": "[돌파매수]\n1. 일반매도 스크립트 결과가 거짓이고,\n2. 전일종가는 고가 대비 -5%이내이거나 -5%이하의 경우 전일 고가를 넘어야 하고,\n3. 최고종가 갱신봉이 당일 1개 이상이고 전체 2개 이상이어야 하고,\n4. 거래량이 최종종가의 obv가 현재 obv보다 작거나, 현재봉 거래량이 전일 3분봉 평균거래량의 5배이거나, \n이전 128개봉의 최고거래량 10위의 평균의 80%이상이고,\n5. 마지막 최고종가의 봉상태가 고가와 종가 차이가 저가와 종가 차이보다 작아야 하고,\n6. 당일 최고종가 대비 최저 종가는 -5%이상이고,\n7. 마지막 최고 종가를 현재가가 넘어야 함."
    },
    "돌파매수": {
        "script": "# 스크립트명 : 돌파매수\n#ret(True)\n# 다른코드로 테스트\n#code='018250'\n#echo(f'coide={code}')\n\n# 차트\nm3 = ChartManager(code, 'mi', 3)\ndt = ChartManager(code, 'dy')\n\n# 함수주입\ndh, dc, do, dv = dt.h, dt.c, dt.o, dt.v\nmo, mh, ml, mc, mv = m3.o, m3.h, m3.l, m3.c, m3.v\n\n# 빠른 리턴\n매도조건 = 일반매도(logoff=True)\nif 매도조건:\n    echo(f'[{False}] ({code} {name}) 취소원인=매도조건에 해당')\n    ret(False)\n\n# 전일 종가는 최고가 기준 -5% 이상이 아니면 전일 고가를 넘어야 함\n전일종가율 = div(dc(1) - dh(1), dh(1), 0)\nif dh(1) > mc() and 전일종가율 < -0.05:\n    echo(f'[{False}] ({code} {name}) 취소원인=전일종가율({전일종가율*100:.2f}) 불충족')\n    ret(False)\n\n# 1봉전 128봉중 최고거래량 cnt개의 평균    \n탑텐평균 = m3.top_volume_avg(n=128, m=1, cnt=10) * 0.8\n탑텐평균조건 = mv() >= 탑텐평균\n\n# 최근 n 개봉이 전일 3분봉 평균 거래량의 5배 이상\n최근최고봉 = max(mv(), mv(1), mv(2), mv(3), mv(4), mv(5))\n전일삼분평균 = dv(1) / 128\n삼분평균조건 = 최근최고봉 > 전일삼분평균 * 5\n\n# 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\ngcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n최고종가 = gcts[0] #개장후n봉최고종가\n당일봉수 = gcts[1]\n최고종가_len = len(최고종가) if 최고종가 else 0\n\nif 최고종가_len <= 1 or 최고종가[-1] > 당일봉수: \n    echo(f'[False] ({code} {name}) 취소원인={최고종가} 당일최고종가 1개 이하')\n    ret(False)\necho(f'당일봉수={당일봉수} {최고종가}')\n\nobvs = m3.get_obv_array(최고종가[-1] + 1)\nOBV조건 = obvs[최고종가[-1]] < obvs[0] if 최고종가[-1] >= 2 else True\n\n# 거래량 판단\nif not (탑텐평균조건 or 삼분평균조건 or OBV조건):\n    msg = ''\n    if not 탑텐평균조건: msg += '탑텐평균조건, '\n    if not 삼분평균조건: msg += '삼분평균조건, '\n    if not OBV조건: msg += 'OBV조건, '\n    echo(f'[{False}] ({code} {name}) 취소원인={msg}조건 불충족')\n    ret(False)\n\n# 마지막 최고종가의 위치까지 각 최고, 최저값 획득\nextr = m3.get_extremes(n=최고종가[-1], m=1)\n\n# 종가 기준 고가보다 저가가 더 큰것만 매수(첫봉 음봉등 배제-아래꼬리가 더 길면 매수)\nloc = 최고종가[-1]\n고저대비 = mc(loc) - ml(loc) > mh(loc) - mc(loc)\n#고저대비 = mc() - extr['ll'] > extr['hh'] - mc()\n\n# 시간조정조건 : 최고종가에서 종가상 5%이상 빠지면 매수 안 함\n하락율 = div(extr['hc'] - extr['lc'], extr['hc'], 0)\n시간조정조건 = 하락율 > -0.05\n현재봉조건 = mc() >= mc(최고종가[-1])\n\n# 로깅\nmsg = ''\nif not 고저대비: msg += f'고저대비, '\nif not 시간조정조건: msg += f'시간조정조건({하락율}>-0.05, '\nif not 현재봉조건: msg += f'현재봉조건({mc():,d}>={mc(최고종가[-1]):,d})'\n\n# 전략평가 결과 전달\nresult = 고저대비 and 시간조정조건 and 현재봉조건\nif msg: msg = '취소원인 = ' + msg +' 불충족'\necho(f'[{result}] ({code} {name}) {msg}')\n\nret(result)",
        "type": "bool",
        "desc": "[돌파매수]\n1. 일반매도 스크립트 결과가 거짓이고,\n2. 전일종가는 고가 대비 -5%이내이거나 -5%이하의 경우 전일 고가를 넘어야 하고,\n3. 최고종가 갱신봉이 당일 1개 이상이고 전체 2개 이상이어야 하고,\n4. 거래량이 최종종가의 obv가 현재 obv보다 작거나, 현재봉 거래량이 전일 3분봉 평균거래량의 5배이거나, \n이전 128개봉의 최고거래량 10위의 평균의 80%이상이고,\n5. 마지막 최고종가의 봉상태가 고가와 종가 차이가 저가와 종가 차이보다 작아야 하고,\n6. 당일 최고종가 대비 최저 종가는 -5%이상이고,\n7. 마지막 최고 종가를 현재가가 넘어야 함."
    },
    "일반매도": {
        "script": "# 스크립트명 : 일반매도\n#ret(False)\n# 다른종목으로 테스트\n#code = '131030'\n\n# 전달 값 확인\nlogoff = is_args('logoff', False)\n\n# 차트정의\ndm = ChartManager(code, 'dy')\nm3 = ChartManager(code, 'mi', 3)\n\n#echo(f'code={code} 현재가={일.c()}')\n\n# 함수주입\ndc = dm.c\nmo, mc, ml, ma = m3.o, m3.c, m3.l, m3.ma\n\n# 미리 계산\nc_limit = hoga(dc(1), 99)\n#echo(f'현재가={dc()}, 상한가={c_limit}')\nup_down_rate = div(mc() - mo(), mo(), 0 )\n\n기준가 = 0\nif not logoff:\n    # 이전 n봉부터 m봉까지 이전 cnt봉중 최고종가 얻기 (최고종가, 당일봉수)\n    gcts = m3.get_close_tops(n=128, cnt=128, m=1) # 업데이트된 최고종가 리스트와 당일 봉수\n    최고종가 = gcts[0] #개장후n봉최고종가\n    당일봉수 = gcts[1]\n    기준가 = min(mc(최고종가[-2]), ml(최고종가[-1])) if len(최고종가) > 1 else 0\n\n# 조건정의(결과 값이 논리값이 되도록 작성)\n상한가 = c_limit <= dc(0)\n기준봉이하 = 기준가 > mc()\n하락전환_3분5이평 = ma(5, 2) <= ma(5, 1) and ma(5, 1) > ma(5, 0) and ma(5) > mc()\n이평역전_3분5_10이평 = ma(10) > ma(5)\n현재가10이평아래 = ma(10) > mc()\n급락 = up_down_rate < -0.03 # 봉하나에 3% 급락\n급등 = up_down_rate > 0.05 # 봉하나에 5% 급등\n\n# 로깅\nmsg = ''\nif 상한가: \n    msg += f'상한가' #(전일{dc(1)}, 현재가{dc()}, 상한가{c_limit}), '\n#elif 기준봉이하:\n#    msg += f'기준봉이하' #(기준봉저가:{ml(최고종가[-1])}, 현재가:{mc()}), '\nelif 하락전환_3분5이평: \n    msg += f'하락전환_3분5이평'\nelif 이평역전_3분5_10이평: \n    msg+= f'이평역전_3분5_10이평'\nelif 현재가10이평아래: \n    msg += f'현재가10이평아래'\n#elif 급락: \n#    msg += f'급락' #(시가:{mo()}, 현재가:{mc()}, 하락률:{up_down_rate:.2f}), '\nelif 급등:\n    msg += f'급등' #(시가:{mo()}, 현재가:{mc()}, 상승률:{up_down_rate:.2f}), '\n\nif not msg: msg = \" 없음\"\n#echo(f\"매도조건: code={code} {name}/{msg}\")\n\n# 전략평가 전송\nresult = 상한가 or 하락전환_3분5이평 or 이평역전_3분5_10이평 or 현재가10이평아래 #or 급등\nif not logoff: echo(f'[{result}] ({code} {name}) 현재가={dc()} / 매도조건: {msg}')\nret(result)",
        "type": "bool",
        "desc": "[일반매도]\n1. 상한가 이거나,\n2. 기준봉 기준가 이하이거나,\n3. 현재봉 기준 3분봉 5이평이 하락전환 하거나,\n4. 현재봉 기준 3분봉 5이평이 10이평 이하 이거나,\n5. 현재가가 10이평 이하 이거나,\n6. 3분봉에서 봉 하나에 3%이상 급락 하거나,\n7. 3분봉에서 봉 하나에 7.5%이상 급등시 매도"
    },
    "이동평균_사용예": {
        "script": "ct = ChartManager(code, 'mi', 3)\n\n# 기본사용\nma5 = ct.indicator(ct.avg, ct.c, 5)\necho(f'기본사용: 0={ma5(0)},1={ma5(1)},2={ma5(2)}')\n\n# 주입하여 사용\nma = ct.ma # ma에 주입\necho(f'주입사용: 0={ma(5,0)},1={ma(5,1)},2={ma(5,2)}')\n\n# 리스트로 받아와 사용\nm5 = ct.get_ma(5, 10) # 5이평 10개 받음\necho(f'리스트로: 0={m5[0]},1={m5[1]}, 2={m5[2]}')\n\n# 클래스를 정의하여 이용\nma5 = FMA(code, 'mi', 1, 5)\necho(f'클래스로: 0={m5[0]},1={m5[1]}, 2={m5[2]}')\n\n# 결론\n# 주입사용이 최고 좋다 - 빠르고 메모리 효율 좋고 유연성(동적 기간), 간결\n# 다음이 indicator - 캐싱효과 \n\nresult = True\nret(result)",
        "type": "bool",
        "desc": ""
    },
    "조건평가데이타": {
        "script": "ct = ChartManager(code, 'dy', 3)\n\n# 최근 종가가 60000 미만인 봉 이후로 몇 봉이 지났는지 알고 싶을 때\nbars = ct.bars_since(lambda i: ct.c(i) < 60000)\necho(f'지난봉수: {bars}')\n\n# 최근 2번째로 종가가 60000 미만 이후부터 현재까지 고가의 최고값\nhigh = ct.highest_since(2, lambda i: ct.c(i) < 60000, ct.h)\necho(f'최고가: {high}')\n\n#최근 3번째로 종가가 60000을 넘은 시점의 시가:\nopen_price = ct.value_when(3, lambda i: ct.c(i) > 60000, ct.o)\necho(f'세번째: {open_price}')\n\n#시간이 '090000'이후로 지나간 봉수:\nmt = ChartManager(code, 'mi', 3)\npast_bars = mt.bars_since(lambda x: mt.bar_time(x) <= '090000')\necho(f'시작시간: 현재봉:{mt.bar_time()} 지난봉:{past_bars}')\n\nresult = True\nret(result)",
        "type": "bool",
        "desc": ""
    },
    "test_kwargs": {
        "script": "\n# 테스트 스크립트\necho(f\"종목코드: {code}\")\necho(f\"종목명: {name}\")\necho(f\"수량: {qty}\")\necho(f\"가격: {price}\")\necho(f\"전체 kwargs: {kwargs}\")\n\n# 사용자 정의 변수 테스트\nif 'test_var' in kwargs:\n    echo(f\"사용자 변수: {test_var}\")\n\n# 결과 반환\nret(True)\n",
        "type": "bool",
        "desc": "kwargs 전달 테스트"
    },
    "script_a": {
        "script": "\n# 스크립트 A\necho(\"스크립트 A 실행\")\nresult = run_script('script_b', kwargs={'code': code, 'name': name})\necho(f\"스크립트 B 결과: {result}\")\nret(True)\n",
        "type": "bool",
        "desc": "스크립트 A"
    },
    "script_b": {
        "script": "\n# 스크립트 B\necho(\"스크립트 B 실행\")\nresult = run_script('script_c', kwargs={'code': code, 'name': name})\necho(f\"스크립트 C 결과: {result}\")\nret(True)\n",
        "type": "bool",
        "desc": "스크립트 B"
    },
    "script_c": {
        "script": "\n# 스크립트 C\necho(\"스크립트 C 실행\")\n# 여기서 A를 호출하면 순환 참조!\nresult = run_script('script_a', kwargs={'code': code, 'name': name})\necho(f\"스크립트 A 결과: {result}\")\nret(True)\n",
        "type": "bool",
        "desc": "스크립트 C"
    }
}